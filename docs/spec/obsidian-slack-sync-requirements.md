# Obsidian Slack 同期プラグイン 要件定義書

## 概要

Slack に投稿されたメッセージを自動的に Obsidian に同期し、チャンネルごとに異なる
保存先や形式で整理するプラグイン。ユーザーが Slack で気軽に投稿したメモ、アイデ
ア、日々の思考などを、Obsidian の適切な場所に自動的に保存・整理することで、情報
の一元管理と効率的な知識管理を実現する。

## ユーザストーリー

### ストーリー 1: 日常的なメモの自動保存

- **である** Obsidian ユーザー **として**
- **私は** Slack に投稿したメモを自動的に Obsidian に保存 **したい**
- **そうすることで** 思いついた時に気軽にメモを残し、後で Obsidian で整理・活用
  できる

### ストーリー 2: チャンネル別の自動整理

- **である** 複数の種類の情報を管理するユーザー **として**
- **私は** Slack のチャンネルごとに異なる保存先に自動分類 **したい**
- **そうすることで** メモ、アイデア、タスクなどを適切に整理された状態で管理でき
  る

### ストーリー 3: デイリーノートへの統合

- **である** デイリーノートを活用するユーザー **として**
- **私は** その日の Slack 投稿をデイリーノートに自動追記 **したい**
- **そうすることで** 日々の思考や活動を時系列で振り返ることができる

## 機能要件（EARS 記法）

### 通常要件

- REQ-001: システムは Slack API を使用してメッセージを定期的に取得しなければなら
  ない
- REQ-002: システムは 取得したメッセージを Obsidian の Markdown 形式で保存しなけ
  ればならない
- REQ-003: システムは チャンネルごとに異なる保存先を設定できなければならない
- REQ-004: システムは メッセージの投稿日時を保持しなければならない
- REQ-005: システムは 同期済みのメッセージを重複して保存してはならない
- REQ-006: システムは ユーザーが同期間隔を設定できなければならない

### 条件付き要件

- REQ-101: メモチャンネルに投稿された場合、システムは メッセージを指定されたメモ
  フォルダに保存しなければならない
- REQ-102: アイデアチャンネルに投稿された場合、システムは メッセージを指定された
  アイデアフォルダに保存しなければならない
- REQ-103: デイリーノート設定が有効な場合、システムは その日の投稿をデイリーノー
  トに追記しなければならない
- REQ-104: メッセージにスレッドがある場合、システムは スレッドの内容も含めて保存
  しなければならない
- REQ-105: メッセージに添付ファイルがある場合、システムは ファイル情報をリンクと
  して保存しなければならない
- REQ-106: 同期エラーが発生した場合、システムは エラーログを記録し、次回の同期で
  再試行しなければならない

### 状態要件

- REQ-201: Obsidian が起動している場合、システムは 設定された間隔で自動同期を実
  行しなければならない
- REQ-202: 手動同期が実行中の場合、システムは 進行状況を表示しなければならない
- REQ-203: Slack API の認証が無効な場合、システムは ユーザーに再認証を促さなけれ
  ばならない

### オプション要件

- REQ-301: システムは メッセージにタグを自動付与してもよい
- REQ-302: システムは メッセージをテンプレートに基づいてフォーマットしてもよい
- REQ-303: システムは 特定のユーザーのメッセージのみをフィルタリングしてもよい
- REQ-304: システムは メッセージの内容に基づいて自動分類してもよい
- REQ-305: システムは 同期履歴を表示する機能を提供してもよい

### 制約要件

- REQ-401: システムは Slack API のレート制限を遵守しなければならない
- REQ-402: システムは Obsidian のプラグイン API の仕様に準拠しなければならない
- REQ-403: システムは ユーザーの Slack 認証情報を安全に保管しなければならない
- REQ-404: システムは 大量のメッセージ処理時でも Obsidian の動作を妨げてはならな
  い

## 非機能要件

### パフォーマンス

- NFR-001: 100 件のメッセージの同期処理は 30 秒以内に完了すること
- NFR-002: バックグラウンド同期は Obsidian の編集作業に影響を与えないこと
- NFR-003: プラグインの起動時間は 3 秒以内であること

### セキュリティ

- NFR-101: Slack API トークンは暗号化して保存すること
- NFR-102: 通信は HTTPS を使用すること
- NFR-103: 認証情報は Obsidian の設定ファイルに平文で保存しないこと

### ユーザビリティ

- NFR-201: 初期設定は 5 分以内に完了できること
- NFR-202: エラーメッセージは問題解決に必要な情報を含むこと
- NFR-203: 設定画面は直感的で理解しやすい UI であること

### 信頼性

- NFR-301: ネットワークエラー時は自動的にリトライすること
- NFR-302: 部分的な同期失敗があっても、成功した分は保存されること
- NFR-303: 同期状態は永続化され、再起動後も継続できること

## Edge ケース

### エラー処理

- EDGE-001: Slack API がダウンしている場合、エラーを記録し次回同期時に再試行
- EDGE-002: Obsidian の保存先フォルダが存在しない場合、自動的に作成
- EDGE-003: 同一メッセージが編集された場合、更新版を保存し履歴を保持
- EDGE-004: API トークンが無効化された場合、ユーザーに通知し再認証を要求

### 境界値

- EDGE-101: 1000 文字を超える長文メッセージの場合、適切に分割して保存
- EDGE-102: 1 日に 1000 件以上のメッセージがある場合、バッチ処理で対応
- EDGE-103: 添付ファイルが 10 個以上ある場合、すべてのリンクを保存
- EDGE-104: 同期間隔が 1 分未満に設定された場合、1 分に自動調整

### 特殊ケース

- EDGE-201: 絵文字のみのメッセージも正しく保存
- EDGE-202: マルチバイト文字（日本語等）を含むメッセージの正確な処理
- EDGE-203: Slack のメンション（@user）を Obsidian のリンク形式に変換
- EDGE-204: コードブロックを含むメッセージの適切なフォーマット保持

## 受け入れ基準

### 機能テスト

- [ ] Slack API との接続が正常に確立できる
- [ ] 指定したチャンネルのメッセージが取得できる
- [ ] メッセージが Obsidian の指定フォルダに保存される
- [ ] チャンネル別の保存先設定が機能する
- [ ] デイリーノートへの追記が正しく動作する
- [ ] 重複メッセージが保存されない
- [ ] スレッドメッセージが階層構造で保存される
- [ ] 添付ファイルのリンクが正しく保存される
- [ ] 手動同期と自動同期の両方が動作する
- [ ] 同期間隔の設定が反映される

### 非機能テスト

- [ ] 100 件のメッセージ同期が 30 秒以内に完了する
- [ ] 認証情報が暗号化されて保存される
- [ ] ネットワークエラー時にリトライが実行される
- [ ] Obsidian の通常操作に影響がない
- [ ] エラーメッセージが適切に表示される
- [ ] 長文メッセージが正しく処理される
- [ ] 日本語を含むメッセージが文字化けしない
- [ ] API レート制限に達してもエラーにならない

### 統合テスト

- [ ] プラグインのインストールから初期設定までスムーズに完了できる
- [ ] 既存の Obsidian ノートと干渉しない
- [ ] 他の Obsidian プラグインと共存できる
- [ ] Obsidian の再起動後も設定が保持される
- [ ] 大量のメッセージがある環境でも安定動作する
