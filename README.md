# Obsidian Slack Memo

SlackのメッセージをObsidianに自動保存するプラグインです。チームのコミュニケーションを検索可能なナレッジベースとして活用できます。

## 機能

- 📥 **自動同期** - Slackメッセージを定期的に自動取得
- 📝 **Markdown変換** - メッセージを整形されたMarkdownファイルとして保存
- 🗂️ **整理された構造** - チャンネルごと・日付ごとに自動整理
- 🔍 **検索可能** - Obsidianの強力な検索機能でSlackメッセージを検索
- 🔐 **セキュア** - OAuth 2.0による安全な認証

## インストール

### コミュニティプラグインからインストール（推奨）
1. Obsidian設定を開く
2. 「コミュニティプラグイン」→「閲覧」
3. 「Obsidian Slack Memo」を検索
4. インストール → 有効化

### 手動インストール
1. [最新リリース](https://github.com/yourusername/obsidian-slack-memo/releases)から`main.js`、`manifest.json`、`styles.css`をダウンロード
2. Vaultの`.obsidian/plugins/obsidian-slack-memo/`フォルダに配置
3. Obsidianを再起動し、プラグインを有効化

## 初期設定

### 1. Slack Appの作成と設定

1. [Slack APIサイト](https://api.slack.com/apps)にアクセス
2. 「Create New App」→「From scratch」を選択
3. アプリ名（例：「Obsidian Slack Memo」）を入力し、ワークスペースを選択
4. 「OAuth & Permissions」セクションで以下の**Bot Token Scopes**を追加：
   ```
   channels:read      - パブリックチャンネル一覧の取得
   channels:history   - パブリックチャンネルのメッセージ読み取り
   groups:read        - プライベートチャンネル一覧の取得
   groups:history     - プライベートチャンネルのメッセージ読み取り
   im:read           - DM一覧の取得
   im:history        - DMのメッセージ読み取り
   mpim:read         - グループDM一覧の取得
   mpim:history      - グループDMのメッセージ読み取り
   users:read        - ユーザー情報の取得
   team:read         - チーム情報の取得
   ```
5. 「Install to Workspace」をクリックしてワークスペースにインストール
6. **Bot User OAuth Token**（`xoxb-`で始まる）をコピー

### 2. Slackワークスペースでの設定

Botがチャンネルにアクセスするには、各チャンネルにBotを追加する必要があります：

#### 自動参加（推奨）
プラグインが自動的にチャンネルへの参加を試みます。同期実行時に参加に成功すると通知が表示されます。

#### 手動でチャンネルに追加
1. 同期したいチャンネルを開く
2. `/invite @あなたのアプリ名` を実行
3. または、チャンネル情報 → 「インテグレーション」タブ → 「アプリを追加」

**⚠️ 重要：** Botがチャンネルのメンバーでない場合、そのチャンネルのメッセージは取得できません。

### 3. プラグインの設定

1. Obsidian設定 → Obsidian Slack Memo
2. 「Slackトークン」フィールドに、先ほどコピーした**Bot User OAuth Token**を貼り付け
3. 設定を保存
4. 「手動同期を実行」をクリックしてテスト実行

**📝 注意：** トークンは`xoxb-`で始まる必要があります。`xoxp-`や`xoxe-`で始まるトークンは使用できません。

## 使い方

### 基本的な使い方

#### 手動で同期する
- リボンアイコンをクリック
- または、コマンドパレット（`Ctrl/Cmd + P`）で「Slack: 手動同期を実行」

#### 自動同期を有効にする
1. 設定画面で「自動同期を有効化」をオン
2. 同期間隔を設定（5分〜24時間）

### コマンド

| コマンド | 説明 |
|---------|------|
| Slack: 手動同期を実行 | 今すぐメッセージを同期 |
| Slack: 同期状況を表示 | 現在の同期状態を確認 |
| Slack: 設定を開く | プラグイン設定画面を開く |
| Slack: キャッシュをクリア | 同期履歴をリセット |

### ショートカットキー

| 操作 | Windows/Linux | Mac |
|------|---------------|-----|
| 手動同期 | `Ctrl + Shift + S` | `Cmd + Shift + S` |
| 同期状況 | `Ctrl + Shift + I` | `Cmd + Shift + I` |

## ファイル構成

メッセージは以下のような構成で保存されます：

```
Slack Sync/              # メインフォルダ（設定で変更可能）
└── Daily/               # 日付別整理
    ├── 2024-01-15.md   # 日付ごとのファイル
    └── 2024-01-16.md
```

各ファイルの中身：
```markdown
# 2024-01-15 - Slack Messages

## #general
**John Doe** 09:30
Hello everyone! How's the project going?

**Jane Smith** 09:35  
It's going well! We're on schedule.

## #obsidian
**Mike** 10:15
Just updated the plugin, works great!
```

## 設定項目

### 基本設定
- **同期対象チャンネル** - 同期するチャンネルを選択
- **自動同期** - 自動同期のオン/オフ
- **同期間隔** - 自動同期の実行間隔
- **保存先フォルダ** - メッセージの保存場所

### 詳細設定
- **日付形式** - ファイル名の日付フォーマット
- **タイムゾーン** - メッセージ時刻の表示設定
- **ファイル添付** - 添付ファイル情報の同期

## よくある質問

### Q: どのようなメッセージが同期されますか？
A: 選択したチャンネルの通常のメッセージ、スレッド、リアクション、添付ファイル情報が同期されます。

### Q: プライベートチャンネルも同期できますか？
A: はい。ただし、Slack Appに適切な権限（`groups:history`、`groups:read`）を設定する必要があります。

### Q: 過去のメッセージも同期されますか？
A: 初回同期時は過去30日分のメッセージを取得します。その後は新しいメッセージのみ同期されます。

### Q: 同期したメッセージは編集できますか？
A: はい。Obsidian内で自由に編集できます。ただし、次回同期時に上書きされないよう注意してください。

### Q: 同期が遅い場合は？
A: 設定で同期間隔を長くするか、同期するチャンネル数を減らしてください。

## トラブルシューティング

### 「Slackトークンが無効です」エラー
1. **Bot User OAuth Token**を使用していることを確認（`xoxb-`で始まる）
2. Slack App設定で必要なスコープが追加されていることを確認
3. トークンを再生成してプラグイン設定を更新

### 「missing_scope」エラー
1. Slack App設定の「OAuth & Permissions」で以下のスコープが追加されていることを確認：
   - `channels:read`, `channels:history`
   - `groups:read`, `groups:history`
   - `users:read`, `team:read`
2. スコープを追加後、ワークスペースに再インストール
3. 新しいBot User OAuth Tokenをプラグイン設定に設定

### 「not_in_channel」エラー（チャンネルにアクセスできない）
1. Botが対象チャンネルのメンバーでない場合に発生
2. プラグインが自動参加を試みますが、失敗した場合は手動で追加：
   - チャンネルで `/invite @アプリ名` を実行
   - または、チャンネル設定から「インテグレーション」でアプリを追加

### メッセージが同期されない
1. 開発者コンソール（F12）でエラーログを確認
2. インターネット接続を確認
3. Botがチャンネルメンバーであることを確認
4. 過去7日以内にメッセージが存在することを確認

### Obsidianが重くなる
1. 自動同期の間隔を長くする（15分以上推奨）
2. 同期するチャンネル数を減らす
3. 古いファイルをアーカイブする

## プライバシーとセキュリティ

- このプラグインはSlackのメッセージをローカルに保存します
- 認証情報は安全にObsidianの設定に保存されます
- 外部サーバーへのデータ送信は行いません
- Slack APIの通信はHTTPSで暗号化されています

## サポート

問題や要望がある場合は、[GitHub Issues](https://github.com/yourusername/obsidian-slack-memo/issues)でお知らせください。

## ライセンス

MIT License - 詳細は[LICENSE](LICENSE)ファイルをご覧ください。