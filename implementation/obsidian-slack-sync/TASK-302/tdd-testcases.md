# TASK-302: 同期状態表示UI - テストケース設計

## テスト戦略
- 単体テスト: 各UIコンポーネントの独立動作確認
- 統合テスト: 同期プロセスとUIの連携確認
- E2Eテスト: ユーザーシナリオの完全動作確認

## 単体テスト

### 1. SyncStatusManager - 状態管理クラス

**TC-SS-001**: 初期状態の確認
- **前提条件**: SyncStatusManagerインスタンス作成直後
- **実行**: 状態プロパティの確認
- **期待結果**: status=IDLE, progress=0, history=空配列

**TC-SS-002**: 同期開始時の状態更新
- **前提条件**: IDLE状態のSyncStatusManager
- **実行**: startSync()メソッド呼び出し
- **期待結果**: status=SYNCING, startTime設定

**TC-SS-003**: 進捗更新処理
- **前提条件**: SYNCING状態のSyncStatusManager
- **実行**: updateProgress(3, 10)呼び出し
- **期待結果**: progress.current=3, progress.total=10, percentage=30

**TC-SS-004**: 同期完了時の処理
- **前提条件**: SYNCING状態のSyncStatusManager
- **実行**: completeSync(messageCount=50)呼び出し
- **期待結果**: status=SUCCESS, 履歴に追加, 完了通知

**TC-SS-005**: エラー発生時の処理
- **前提条件**: SYNCING状態のSyncStatusManager
- **実行**: setError(new Error("Network error"))呼び出し
- **期待結果**: status=ERROR, lastError設定, エラー通知

**TC-SS-006**: 同期キャンセル処理
- **前提条件**: SYNCING状態のSyncStatusManager
- **実行**: cancelSync()呼び出し
- **期待結果**: status=IDLE, isCancelled=true

**TC-SS-007**: 履歴管理（追加）
- **前提条件**: 履歴が99件存在
- **実行**: 新しい履歴アイテム追加
- **期待結果**: 履歴件数=100, 最新が先頭

**TC-SS-008**: 履歴管理（上限超過）
- **前提条件**: 履歴が100件存在
- **実行**: 新しい履歴アイテム追加
- **期待結果**: 履歴件数=100, 最古の1件削除

### 2. StatusBarItem - ステータスバー表示

**TC-SB-001**: 初期表示の確認
- **前提条件**: StatusBarItemコンポーネント作成
- **実行**: 初期描画
- **期待結果**: アイドル状態のアイコンとテキスト表示

**TC-SB-002**: 同期中状態の表示
- **前提条件**: IDLE状態のStatusBarItem
- **実行**: 状態をSYNCINGに更新
- **期待結果**: アニメーション付きアイコン、「同期中...」テキスト

**TC-SB-003**: 成功状態の表示
- **前提条件**: SYNCING状態のStatusBarItem
- **実行**: 状態をSUCCESSに更新
- **期待結果**: 成功アイコン、「同期完了」テキスト、最終同期時刻

**TC-SB-004**: エラー状態の表示
- **前提条件**: SYNCING状態のStatusBarItem
- **実行**: 状態をERRORに更新
- **期待結果**: エラーアイコン、「同期エラー」テキスト

**TC-SB-005**: クリックイベント処理
- **前提条件**: StatusBarItem表示中
- **実行**: ステータスバーアイテムクリック
- **期待結果**: 進捗モーダルが開く

**TC-SB-006**: ホバーツールチップ
- **前提条件**: StatusBarItem表示中
- **実行**: マウスホバー
- **期待結果**: 詳細情報のツールチップ表示

**TC-SB-007**: アニメーション制御
- **前提条件**: SYNCING状態のStatusBarItem
- **実行**: 5秒間の表示確認
- **期待結果**: 一定間隔でのアニメーション継続

**TC-SB-008**: テーマ対応
- **前提条件**: ダークテーマ有効
- **実行**: StatusBarItem表示
- **期待結果**: テーマに適したカラー表示

### 3. SyncProgressModal - 進捗モーダル

**TC-PM-001**: モーダル初期表示
- **前提条件**: SyncProgressModal作成
- **実行**: open()メソッド呼び出し
- **期待結果**: モーダルが表示、基本UI要素存在

**TC-PM-002**: 進捗バー表示
- **前提条件**: 表示中のSyncProgressModal
- **実行**: 進捗30%を設定
- **期待結果**: プログレスバー30%表示、「30%」テキスト

**TC-PM-003**: 現在処理チャンネル表示
- **前提条件**: 表示中のSyncProgressModal
- **実行**: 現在チャンネル「#general」を設定
- **期待結果**: 「処理中: #general」テキスト表示

**TC-PM-004**: ログ表示機能
- **前提条件**: 表示中のSyncProgressModal
- **実行**: ログメッセージ追加
- **期待結果**: ログエリアに新しいメッセージ表示

**TC-PM-005**: キャンセルボタン動作
- **前提条件**: SYNCING状態のSyncProgressModal
- **実行**: キャンセルボタンクリック
- **期待結果**: 同期キャンセル確認ダイアログ表示

**TC-PM-006**: 閉じるボタン動作
- **前提条件**: 表示中のSyncProgressModal
- **実行**: 閉じるボタンクリック
- **期待結果**: モーダルが非表示

**TC-PM-007**: 再試行ボタン表示
- **前提条件**: ERROR状態のSyncProgressModal
- **実行**: モーダル表示確認
- **期待結果**: 再試行ボタンが表示される

**TC-PM-008**: 自動更新機能
- **前提条件**: SYNCING状態のSyncProgressModal
- **実行**: 外部から進捗更新
- **期待結果**: UI自動更新、最新情報表示

**TC-PM-009**: エラーメッセージ表示
- **前提条件**: ERROR状態のSyncProgressModal
- **実行**: エラー情報設定
- **期待結果**: エラーメッセージと詳細情報表示

**TC-PM-010**: 完了状態の表示
- **前提条件**: SUCCESS状態のSyncProgressModal
- **実行**: 完了情報設定
- **期待結果**: 完了メッセージと統計情報表示

### 4. NotificationManager - 通知システム

**TC-NM-001**: トースト通知表示
- **前提条件**: NotificationManager初期化
- **実行**: showToast("同期完了", "success")呼び出し
- **期待結果**: 成功タイプのトースト通知表示

**TC-NM-002**: 通知自動消去
- **前提条件**: 表示中のトースト通知
- **実行**: 5秒間待機
- **期待結果**: 通知が自動で消去される

**TC-NM-003**: 複数通知の管理
- **前提条件**: NotificationManager初期化
- **実行**: 3つの通知を連続表示
- **期待結果**: 最大3つまで同時表示、古いものから消去

**TC-NM-004**: エラーダイアログ表示
- **前提条件**: NotificationManager初期化
- **実行**: showError("重大なエラー")呼び出し
- **期待結果**: エラーダイアログ表示、手動クリア必要

**TC-NM-005**: 通知レベル制御
- **前提条件**: 通知レベル設定可能
- **実行**: レベル設定後の各種通知
- **期待結果**: 設定レベル以上の通知のみ表示

**TC-NM-006**: カスタムアクション付き通知
- **前提条件**: NotificationManager初期化
- **実行**: アクションボタン付き通知表示
- **期待結果**: 通知にボタン表示、クリックで指定処理実行

### 5. SyncHistoryView - 履歴表示

**TC-SH-001**: 履歴リスト表示
- **前提条件**: 10件の履歴データ存在
- **実行**: SyncHistoryView表示
- **期待結果**: 10件の履歴が新しい順で表示

**TC-SH-002**: 履歴詳細表示
- **前提条件**: 履歴リスト表示中
- **実行**: 履歴項目クリック
- **期待結果**: 詳細情報モーダル表示

**TC-SH-003**: 履歴フィルター機能
- **前提条件**: 成功/失敗混在の履歴
- **実行**: 「エラーのみ」フィルター選択
- **期待結果**: エラー履歴のみ表示

**TC-SH-004**: 履歴削除機能
- **前提条件**: 履歴リスト表示中
- **実行**: 履歴項目の削除ボタンクリック
- **期待結果**: 確認ダイアログ後、履歴削除

**TC-SH-005**: 履歴エクスポート
- **前提条件**: 履歴データ存在
- **実行**: エクスポートボタンクリック
- **期待結果**: CSVファイルダウンロード

**TC-SH-006**: 空履歴表示
- **前提条件**: 履歴データなし
- **実行**: SyncHistoryView表示
- **期待結果**: 「履歴がありません」メッセージ表示

**TC-SH-007**: 履歴検索機能
- **前提条件**: 多数の履歴データ
- **実行**: 検索ボックスに「error」入力
- **期待結果**: エラーを含む履歴のみ表示

**TC-SH-008**: ページネーション
- **前提条件**: 150件の履歴データ
- **実行**: 履歴表示
- **期待結果**: 50件ずつページ分割表示、ナビゲーション可能

## 統合テスト

### 6. 同期プロセス連携

**TC-INT-001**: 同期開始から完了までの流れ
- **前提条件**: アイドル状態のシステム
- **実行**: 手動同期開始
- **期待結果**: 状態遷移(IDLE→SYNCING→SUCCESS)、通知表示

**TC-INT-002**: エラー発生時の処理
- **前提条件**: 同期実行中
- **実行**: ネットワークエラー発生シミュレート
- **期待結果**: ERROR状態移行、エラー通知、詳細情報表示

**TC-INT-003**: キャンセル処理
- **前提条件**: 同期実行中
- **実行**: ユーザーが同期キャンセル
- **期待結果**: 同期停止、IDLE状態復帰、キャンセル通知

**TC-INT-004**: 複数チャンネル同期の進捗
- **前提条件**: 5つのチャンネル設定
- **実行**: 全チャンネル同期開始
- **期待結果**: チャンネル別進捗表示、総合進捗正確

**TC-INT-005**: 履歴への記録
- **前提条件**: 同期実行
- **実行**: 同期完了まで待機
- **期待結果**: 履歴に新しい記録追加、正確な統計

**TC-INT-006**: 状態復元機能
- **前提条件**: 同期実行中にObsidian再起動
- **実行**: プラグイン再読み込み
- **期待結果**: 前回状態の検出と適切な処理

### 7. UI連携テスト

**TC-UI-001**: 複数UIコンポーネント同期
- **前提条件**: ステータスバーとモーダル両方表示
- **実行**: 同期状態変更
- **期待結果**: 両UIが同時更新

**TC-UI-002**: 通知とUI状態の整合性
- **前提条件**: 各種通知設定有効
- **実行**: 同期実行から完了まで
- **期待結果**: 適切なタイミングでの通知表示、UI状態と一致

**TC-UI-003**: モーダルとステータスバーの連携
- **前提条件**: モーダル表示中
- **実行**: 外部からの同期状態変更
- **期待結果**: モーダル内容更新、ステータスバーも連動更新

## E2Eテスト

### 8. ユーザーシナリオ

**TC-E2E-001**: 初回同期実行
- **シナリオ**: 新規ユーザーが初めて同期を実行
- **ステップ**:
  1. プラグイン有効化
  2. 設定完了
  3. 手動同期実行
  4. 結果確認
- **期待結果**: 全プロセスが直感的、適切なフィードバック

**TC-E2E-002**: 日常的な同期使用
- **シナリオ**: 既存ユーザーの定期的な同期使用
- **ステップ**:
  1. Obsidian起動
  2. 自動同期実行
  3. ステータス確認
  4. 履歴確認
- **期待結果**: シームレスな体験、必要な情報表示

**TC-E2E-003**: エラー対処シナリオ
- **シナリオ**: 同期エラーが発生した際の対処
- **ステップ**:
  1. 同期実行
  2. エラー発生
  3. エラー詳細確認
  4. 問題解決
  5. 再試行
- **期待結果**: 明確なエラー情報、解決手順提示

**TC-E2E-004**: 長時間同期の体験
- **シナリオ**: 大量メッセージの長時間同期
- **ステップ**:
  1. 大量履歴の同期開始
  2. 進捗確認
  3. 途中でのキャンセル試行
  4. 再開と完了
- **期待結果**: 進捗の可視性、制御可能性

**TC-E2E-005**: マルチチャンネル管理
- **シナリオ**: 複数チャンネルの同期管理
- **ステップ**:
  1. 10チャンネル設定
  2. 全体同期実行
  3. 個別チャンネル状況確認
  4. エラーチャンネルの特定
- **期待結果**: チャンネル別の明確な状態表示

### 9. パフォーマンステスト

**TC-PERF-001**: UI応答性テスト
- **条件**: 同期実行中の頻繁なUI操作
- **測定**: UI応答時間
- **基準**: 50ms以内の応答

**TC-PERF-002**: メモリ使用量テスト
- **条件**: 長時間の同期実行
- **測定**: メモリ使用量推移
- **基準**: 50MB以下の追加使用量

**TC-PERF-003**: 履歴データ処理テスト
- **条件**: 10,000件の履歴データ
- **測定**: 表示・検索速度
- **基準**: 1秒以内の応答

**TC-PERF-004**: アニメーション性能テスト
- **条件**: 同期中アニメーション実行
- **測定**: CPU使用率
- **基準**: 5%以下のCPU使用増加

### 10. 互換性テスト

**TC-COMPAT-001**: テーマ互換性
- **条件**: 主要Obsidianテーマでのテスト
- **確認項目**: 視覚的調和、可読性
- **基準**: 全テーマで適切な表示

**TC-COMPAT-002**: モバイル版対応
- **条件**: Obsidianモバイル版での実行
- **確認項目**: 基本機能の動作
- **基準**: 主要機能が利用可能

**TC-COMPAT-003**: プラグイン競合テスト
- **条件**: 人気プラグインとの同時使用
- **確認項目**: 機能競合、エラー発生
- **基準**: 問題なく共存

## テスト実行環境

### 自動テスト環境
- **フレームワーク**: Jest + Testing Library
- **モック**: Obsidian API、ネットワーク、タイマー
- **CI/CD**: GitHub Actions
- **カバレッジ**: 90%以上

### 手動テスト環境
- **OS**: Windows 11, macOS 13, Ubuntu 22.04
- **Obsidianバージョン**: 1.4.0以降
- **テーマ**: Default、Minimal、Darkly
- **デバイス**: デスクトップ、タブレット、スマートフォン

## データ駆動テスト

### テストデータセット
```typescript
const SYNC_TEST_DATA = {
  channels: [
    { id: 'C001', name: 'general', messageCount: 150 },
    { id: 'C002', name: 'random', messageCount: 75 },
    { id: 'C003', name: 'dev', messageCount: 300 }
  ],
  
  errors: [
    { type: 'NetworkError', message: 'Network timeout' },
    { type: 'AuthError', message: 'Invalid token' },
    { type: 'RateLimitError', message: 'API rate limit exceeded' }
  ],
  
  historyItems: [
    { status: 'success', messageCount: 42, duration: 15000 },
    { status: 'error', error: 'Network timeout', duration: 5000 },
    { status: 'cancelled', duration: 3000 }
  ]
};
```

## テストカバレッジ目標

### コードカバレッジ
- **ライン**: 90%以上
- **ブランチ**: 85%以上  
- **関数**: 95%以上

### 機能カバレッジ
- **状態遷移**: 100%
- **UIイベント**: 100%
- **エラーケース**: 95%以上
- **ユーザーシナリオ**: 100%

### 品質基準
- **バグ密度**: 0.1/KLOC以下
- **応答時間**: 要件内
- **ユーザビリティ**: 90%以上の満足度

このテストケース設計に基づいて、次のフェーズでREDテスト（失敗するテスト）の実装を行います。