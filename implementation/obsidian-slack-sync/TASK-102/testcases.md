# TASK-102: Slack APIクライアント実装 - テストケース

## テストケース一覧

### 1. 基本的なAPI呼び出し

#### TC-1.1: 認証トークンの自動付与
- **前提条件**: AuthManagerにトークンが保存されている
- **操作**: APIメソッドを呼び出す
- **期待結果**: Authorizationヘッダーにトークンが設定される

#### TC-1.2: エンドポイントURLの構築
- **前提条件**: APIクライアントが初期化されている
- **操作**: 各APIメソッドを呼び出す
- **期待結果**: 正しいSlack APIエンドポイントにリクエストが送信される

### 2. conversations.list

#### TC-2.1: チャンネルリストの取得（成功）
- **前提条件**: 有効なトークンが設定されている
- **操作**: listChannels()を呼び出す
- **期待結果**: チャンネルの配列が返される

#### TC-2.2: プライベートチャンネルを含む取得
- **前提条件**: types: 'public_channel,private_channel'を指定
- **操作**: listChannels({ types: 'public_channel,private_channel' })
- **期待結果**: パブリックとプライベート両方のチャンネルが返される

#### TC-2.3: ページネーション処理
- **前提条件**: 100件以上のチャンネルが存在
- **操作**: listChannels()を呼び出す
- **期待結果**: すべてのチャンネルが取得される（複数ページ）

#### TC-2.4: 空のチャンネルリスト
- **前提条件**: チャンネルが存在しない
- **操作**: listChannels()を呼び出す
- **期待結果**: 空の配列が返される

### 3. conversations.history

#### TC-3.1: メッセージ履歴の取得（成功）
- **前提条件**: 有効なチャンネルID
- **操作**: getChannelHistory(channelId)
- **期待結果**: メッセージの配列が返される

#### TC-3.2: 差分取得（oldest指定）
- **前提条件**: 特定時刻以降のメッセージを取得
- **操作**: getChannelHistory(channelId, { oldest: timestamp })
- **期待結果**: 指定時刻以降のメッセージのみ返される

#### TC-3.3: 取得件数制限（limit指定）
- **前提条件**: 100件以上のメッセージが存在
- **操作**: getChannelHistory(channelId, { limit: 50 })
- **期待結果**: 50件のメッセージが返される

#### TC-3.4: 存在しないチャンネル
- **前提条件**: 無効なチャンネルID
- **操作**: getChannelHistory('invalid-channel')
- **期待結果**: エラーが返される（channel_not_found）

### 4. conversations.replies

#### TC-4.1: スレッドの返信取得（成功）
- **前提条件**: 有効なチャンネルIDとthread_ts
- **操作**: getThreadReplies(channelId, threadTs)
- **期待結果**: スレッドの返信メッセージが返される

#### TC-4.2: 返信がないスレッド
- **前提条件**: 返信のないメッセージのthread_ts
- **操作**: getThreadReplies(channelId, threadTs)
- **期待結果**: 親メッセージのみが返される

#### TC-4.3: 無効なthread_ts
- **前提条件**: 存在しないthread_ts
- **操作**: getThreadReplies(channelId, 'invalid-ts')
- **期待結果**: エラーが返される

### 5. レート制限処理

#### TC-5.1: 429エラーの自動リトライ
- **前提条件**: APIが429エラーを返す
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: Retry-After秒待機後、自動的にリトライされる

#### TC-5.2: リトライ回数上限
- **前提条件**: 3回連続で429エラー
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: 3回目のリトライ後、エラーが返される

#### TC-5.3: リトライ成功
- **前提条件**: 1回目は429、2回目は成功
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: 2回目のレスポンスが返される

### 6. エラーハンドリング

#### TC-6.1: APIエラーレスポンス
- **前提条件**: APIがエラーレスポンスを返す
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: エラーコードとメッセージが含まれたErrorオブジェクト

#### TC-6.2: ネットワークエラー
- **前提条件**: ネットワーク接続なし
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: ネットワークエラーが返される

#### TC-6.3: タイムアウト
- **前提条件**: APIレスポンスが30秒以内に返らない
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: タイムアウトエラーが返される

#### TC-6.4: 無効なトークン
- **前提条件**: 無効な認証トークン
- **操作**: 任意のAPIメソッドを呼び出す
- **期待結果**: invalid_authエラーが返される

### 7. ページネーション

#### TC-7.1: 次ページの自動取得
- **前提条件**: レスポンスにnext_cursorが含まれる
- **操作**: listChannels()を呼び出す
- **期待結果**: すべてのページが自動的に取得される

#### TC-7.2: カーソルの正しい使用
- **前提条件**: ページネーションが必要なデータ量
- **操作**: APIメソッドを呼び出す
- **期待結果**: 各リクエストで正しいcursorが使用される

## エッジケース

### EC-1: 巨大なレスポンス
- **シナリオ**: 1000件のメッセージを含むレスポンス
- **期待動作**: メモリ効率的に処理される

### EC-2: 特殊文字を含むメッセージ
- **シナリオ**: 絵文字、改行、URLを含むメッセージ
- **期待動作**: 正しくパースされる

### EC-3: 同時リクエスト
- **シナリオ**: 複数のAPIメソッドが同時に呼ばれる
- **期待動作**: 各リクエストが独立して処理される

### EC-4: トークンの更新中
- **シナリオ**: API呼び出し中にトークンが更新される
- **期待動作**: 新しいトークンで再試行される