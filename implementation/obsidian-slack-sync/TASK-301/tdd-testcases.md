# TASK-301: プラグイン設定画面 - テストケース設計

## テスト戦略
- 単体テスト: 各UIコンポーネントの個別動作確認
- 統合テスト: 設定画面全体の動作確認
- E2Eテスト: ユーザーワークフローの確認

## 単体テスト

### 1. PluginSettingTab - コンストラクタ・基本機能

**TC-ST-001**: 正常なコンストラクタ呼び出し
- **前提条件**: 有効なAppとPluginインスタンス
- **実行**: `new PluginSettingTab(app, plugin)`
- **期待結果**: インスタンスが正常に作成される

**TC-ST-002**: 設定タブの表示
- **前提条件**: PluginSettingTabインスタンス
- **実行**: `display()`メソッド呼び出し
- **期待結果**: 設定UIが正しく表示される

**TC-ST-003**: 設定タブの非表示
- **前提条件**: 表示中の設定タブ
- **実行**: `hide()`メソッド呼び出し
- **期待結果**: 設定UIが正しく非表示になる

### 2. Slack認証ボタン機能

**TC-ST-010**: 未認証時の認証ボタン表示
- **前提条件**: Slack認証未完了の状態
- **実行**: 認証セクションの描画
- **期待結果**: 「Slackで認証」ボタンが表示される

**TC-ST-011**: 認証ボタンクリック処理
- **前提条件**: 認証ボタンが表示されている
- **実行**: 認証ボタンクリック
- **期待結果**: OAuth認証フローが開始される

**TC-ST-012**: 認証済み時の状態表示
- **前提条件**: Slack認証完了済み
- **実行**: 認証セクションの描画
- **期待結果**: 認証済み状態と認証解除ボタンが表示される

**TC-ST-013**: 認証解除ボタンの動作
- **前提条件**: 認証済み状態
- **実行**: 認証解除ボタンクリック
- **期待結果**: 認証が解除され、未認証状態に戻る

**TC-ST-014**: 認証エラーの表示
- **前提条件**: 認証プロセスでエラー発生
- **実行**: エラー状態での描画
- **期待結果**: 適切なエラーメッセージが表示される

### 3. チャンネルマッピング設定UI

**TC-ST-020**: チャンネル選択ドロップダウンの表示
- **前提条件**: 認証済み、チャンネルリスト取得済み
- **実行**: チャンネルマッピングセクション表示
- **期待結果**: 利用可能チャンネルがドロップダウンに表示される

**TC-ST-021**: 新規チャンネルマッピング追加
- **前提条件**: チャンネルマッピング設定画面
- **実行**: 「マッピング追加」ボタンクリック
- **期待結果**: 新しいマッピング設定行が追加される

**TC-ST-022**: チャンネルマッピング削除
- **前提条件**: 複数のチャンネルマッピング存在
- **実行**: 特定マッピングの削除ボタンクリック
- **期待結果**: 該当マッピングが削除される

**TC-ST-023**: 保存先フォルダパス入力
- **前提条件**: チャンネルマッピング設定行
- **実行**: フォルダパス入力フィールドに値入力
- **期待結果**: 入力値が正しく反映される

**TC-ST-024**: ファイル名フォーマット設定
- **前提条件**: チャンネルマッピング設定行
- **実行**: ファイル名フォーマット入力
- **期待結果**: フォーマット設定が正しく保存される

**TC-ST-025**: タグ設定の追加・削除
- **前提条件**: チャンネルマッピング設定行
- **実行**: タグの追加・削除操作
- **期待結果**: タグリストが正しく更新される

### 4. 同期間隔設定

**TC-ST-030**: 同期間隔スライダーの動作
- **前提条件**: 同期設定セクション表示
- **実行**: 間隔スライダーの操作
- **期待結果**: 選択値が正しく反映される

**TC-ST-031**: プリセット値の選択
- **前提条件**: 同期間隔ドロップダウン
- **実行**: プリセット値（5分、15分等）選択
- **期待結果**: 選択した間隔が設定される

**TC-ST-032**: カスタム値の入力
- **前提条件**: カスタム入力フィールド表示
- **実行**: カスタム同期間隔の入力
- **期待結果**: カスタム値が正しく設定される

**TC-ST-033**: 自動同期の有効/無効切り替え
- **前提条件**: 自動同期設定チェックボックス
- **実行**: チェックボックスの切り替え
- **期待結果**: 自動同期設定が正しく反映される

**TC-ST-034**: 次回同期時刻の表示
- **前提条件**: 自動同期有効、間隔設定済み
- **実行**: 設定画面の描画
- **期待結果**: 次回同期時刻が正しく表示される

### 5. メッセージフォーマット設定

**TC-ST-040**: タイムスタンプ表示設定
- **前提条件**: フォーマット設定セクション
- **実行**: タイムスタンプ表示チェックボックス操作
- **期待結果**: 設定が正しく反映される

**TC-ST-041**: ユーザー名表示設定
- **前提条件**: フォーマット設定セクション
- **実行**: ユーザー名表示設定の変更
- **期待結果**: 設定が正しく保存される

**TC-ST-042**: メンション変換設定
- **前提条件**: フォーマット設定セクション
- **実行**: メンション変換設定の切り替え
- **期待結果**: 設定が正しく反映される

**TC-ST-043**: プレビュー機能の動作
- **前提条件**: フォーマット設定済み
- **実行**: プレビューボタンクリック
- **期待結果**: 設定したフォーマットのプレビューが表示される

### 6. デイリーノート設定

**TC-ST-050**: デイリーノート機能の有効化
- **前提条件**: デイリーノート設定セクション
- **実行**: 機能有効化チェックボックス操作
- **期待結果**: 関連設定項目が表示される

**TC-ST-051**: デイリーノートフォルダ指定
- **前提条件**: デイリーノート機能有効
- **実行**: フォルダパス入力
- **期待結果**: 指定パスが正しく設定される

**TC-ST-052**: 日付フォーマット設定
- **前提条件**: デイリーノート機能有効
- **実行**: 日付フォーマット文字列入力
- **期待結果**: フォーマットが正しく保存される

**TC-ST-053**: ヘッダーフォーマット設定
- **前提条件**: デイリーノート機能有効
- **実行**: ヘッダーフォーマット入力
- **期待結果**: ヘッダー設定が正しく反映される

## 統合テスト

### 7. 設定データの永続化

**TC-ST-060**: 設定の自動保存
- **前提条件**: 各種設定が変更されている
- **実行**: 設定変更後の自動保存待機
- **期待結果**: 変更内容が自動的に保存される

**TC-ST-061**: 設定の読み込み
- **前提条件**: 保存済み設定データ存在
- **実行**: 設定タブの再表示
- **期待結果**: 保存済み設定が正しく復元される

**TC-ST-062**: 設定のリセット
- **前提条件**: カスタム設定が保存されている
- **実行**: 設定リセットボタンクリック
- **期待結果**: 設定がデフォルト値に戻る

### 8. バリデーション機能

**TC-ST-070**: 必須フィールドのバリデーション
- **前提条件**: 必須設定項目が未入力
- **実行**: 設定保存試行
- **期待結果**: バリデーションエラーが表示される

**TC-ST-071**: パス形式のバリデーション
- **前提条件**: 無効なパス形式の入力
- **実行**: パス設定の変更
- **期待結果**: パス形式エラーが表示される

**TC-ST-072**: 重複チャンネルのバリデーション
- **前提条件**: 同一チャンネルの複数マッピング
- **実行**: チャンネルマッピング保存
- **期待結果**: 重複エラーが表示される

**TC-ST-073**: 数値範囲のバリデーション
- **前提条件**: 範囲外の同期間隔入力
- **実行**: 間隔設定の変更
- **期待結果**: 範囲エラーが表示される

### 9. UI状態管理

**TC-ST-080**: 認証状態による表示切り替え
- **前提条件**: 未認証から認証済みへ状態変化
- **実行**: 認証完了後の画面更新
- **期待結果**: UI要素が正しく切り替わる

**TC-ST-081**: ローディング状態の表示
- **前提条件**: API通信中の状態
- **実行**: 非同期処理実行中の画面
- **期待結果**: ローディングインディケータが表示される

**TC-ST-082**: エラー状態の表示と復旧
- **前提条件**: API通信エラー発生
- **実行**: エラー状態からの復旧操作
- **期待結果**: エラー表示後、正常状態に復帰する

## E2Eテスト

### 10. ユーザーワークフロー

**TC-ST-090**: 初回設定フロー
- **前提条件**: 初回起動のプラグイン
- **実行**: 設定画面での初期設定一連操作
- **期待結果**: 
  1. Slack認証が完了する
  2. チャンネルマッピング設定が保存される
  3. 基本設定が完了する

**TC-ST-091**: 設定変更フロー
- **前提条件**: 既存設定が保存済み
- **実行**: 設定の変更・保存操作
- **期待結果**: 
  1. 設定変更が即座に反映される
  2. 変更内容が保存される
  3. プラグイン再起動後も設定が保持される

**TC-ST-092**: 認証更新フロー
- **前提条件**: 認証期限切れ状態
- **実行**: 再認証からチャンネル設定まで
- **期待結果**: 
  1. 再認証が成功する
  2. 新しいチャンネルリストが取得される
  3. 既存設定が維持される

### 11. レスポンシブ対応テスト

**TC-ST-100**: デスクトップ表示
- **前提条件**: 幅1200px以上の画面
- **実行**: 設定画面の表示
- **期待結果**: 2カラムレイアウトで正しく表示される

**TC-ST-101**: タブレット表示
- **前提条件**: 幅768-1024pxの画面
- **実行**: 設定画面の表示・操作
- **期待結果**: 1カラムレイアウトで操作可能

**TC-ST-102**: モバイル表示
- **前提条件**: 幅768px未満の画面
- **実行**: 設定画面の表示・操作
- **期待結果**: 縦積みレイアウトで操作可能

### 12. アクセシビリティテスト

**TC-ST-110**: キーボードナビゲーション
- **前提条件**: 設定画面表示
- **実行**: Tabキーによる要素間移動
- **期待結果**: 全ての操作可能要素にアクセス可能

**TC-ST-111**: スクリーンリーダー対応
- **前提条件**: スクリーンリーダー有効
- **実行**: 設定画面の音声読み上げ
- **期待結果**: 設定項目が適切に読み上げられる

**TC-ST-112**: フォーカス状態の表示
- **前提条件**: キーボードフォーカス移動
- **実行**: 各要素のフォーカス確認
- **期待結果**: フォーカス状態が視覚的に明確

## パフォーマンステスト

### 13. 応答性テスト

**TC-ST-120**: 設定画面の表示速度
- **前提条件**: プラグイン設定画面を開く
- **実行**: 表示時間の測定
- **期待結果**: 500ms以内で表示完了

**TC-ST-121**: 入力反応時間
- **前提条件**: 設定項目への入力
- **実行**: 入力から反映までの時間測定
- **期待結果**: 100ms以内で反応

**TC-ST-122**: 設定保存速度
- **前提条件**: 設定変更後の保存
- **実行**: 保存完了までの時間測定
- **期待結果**: 1秒以内で保存完了

### 14. メモリ効率テスト

**TC-ST-130**: メモリリークの確認
- **前提条件**: 設定画面の繰り返し表示・非表示
- **実行**: メモリ使用量の監視
- **期待結果**: メモリリークが発生しない

**TC-ST-131**: 大量データの処理
- **前提条件**: 多数のチャンネルマッピング設定
- **実行**: 設定画面の動作確認
- **期待結果**: 性能劣化せずに動作

## エラーハンドリングテスト

### 15. ネットワークエラー処理

**TC-ST-140**: Slack API接続エラー
- **前提条件**: ネットワーク切断状態
- **実行**: 認証操作の実行
- **期待結果**: 適切なエラーメッセージ表示

**TC-ST-141**: 認証タイムアウト
- **前提条件**: 認証プロセス中のタイムアウト
- **実行**: 長時間の認証待機
- **期待結果**: タイムアウトエラーの表示と再試行オプション

**TC-ST-142**: レート制限エラー
- **前提条件**: Slack APIレート制限到達
- **実行**: API呼び出しの実行
- **期待結果**: レート制限警告の表示

### 16. データ整合性エラー

**TC-ST-150**: 設定データ破損
- **前提条件**: 破損した設定データ
- **実行**: 設定画面の表示
- **期待結果**: デフォルト設定での復旧

**TC-ST-151**: バージョン非互換
- **前提条件**: 古いバージョンの設定データ
- **実行**: プラグイン更新後の設定画面表示
- **期待結果**: 自動マイグレーションの実行

## テスト環境設定

### モックオブジェクト
- **MockApp**: Obsidian Appオブジェクト
- **MockPlugin**: プラグインインスタンス
- **MockSlackAPI**: Slack API応答
- **MockSettingTab**: 設定タブベース機能

### テストデータ
- **サンプル設定**: 各種設定パターンのテストデータ
- **チャンネルリスト**: 多様なチャンネル情報
- **エラーケース**: 各種エラー状態のデータ

### テストツール
- **Jest**: ユニットテスト実行
- **Testing Library**: DOM操作テスト
- **MSW**: API通信モック
- **Accessibility Testing**: アクセシビリティ検証

## カバレッジ目標
- **ラインカバレッジ**: 90%以上
- **ブランチカバレッジ**: 85%以上
- **関数カバレッジ**: 100%
- **UI要素カバレッジ**: 全ての操作可能要素をテスト